{% extends '_base.html' %}

{%block content %}

  
{% include 'modal/create_loan_modal.html' %}

<aside id="logo-sidebar"
    class="fixed top-0 left-0 z-40 w-96 h-screen pt-20 transition-transform -translate-x-full bg-[#E2E2E8] border-r border-gray-200 sm:translate-x-0 dark:bg-gray-800 dark:border-gray-700"
    aria-label="Sidebar">

    <div class="w-72 flex flex-row mb-4 items-center cursor-pointer" data-modal-target="authentication-modal" data-modal-toggle="authentication-modal">
        <svg xmlns="http://www.w3.org/2000/svg" width="44" height="20" fill="none" viewBox="0 0 24 24">
            <path fill="green" d="M12 5v14m7-7H5" stroke="green" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p class="text-lg font-normal text-gray-500 lg:text-xl dark:text-gray-400 ml-2">Create new loan...</p>
    </div>
    <div class="h-full px-3 pb-4 overflow-y-auto bg-white dark:bg-gray-800">
        <ul class="space-y-2 font-medium">
            {% for loan in loans %}
          
            <li class="bg-gray-100 p-6" onclick='showDetail("{{loan.id}}")'>
                <div>
                    <h2 class="text-xl font-bold text-gray-800">Loan Details</h2>
                    <div class="flex justify-between items-center mt-4">
                        <div>
                            <p class="text-lg font-semibold text-gray-900">{{request.user.username}}</p>
                            <p class="text-sm text-gray-600">{{loan.loan_date}}</p>
                        </div>
                        <p class="text-xl font-bold text-gray-900">${{loan.loan_amount}}</p>
                    </div>
                </div>
            </li>

    {% endfor %}
         
        </ul>
    </div>
</aside>

<div class="p-4 sm:ml-64">
    <div class="bg-gray-100 p-6">
        <div class="max-w-3xl mx-auto p-8 rounded-lg shadow-md">
            <h1 class="text-2xl font-bold mb-6 text-center">Loan details</h1>
            <div class="flex justify-between mb-4">
                <div class="w-1/2">
                    <p class="text-sm font-medium text-gray-700">Pay to the Order of:</p>
                    <p class="border-b border-gray-300 pb-1" id="order_of">Casey Daniels</p>
                </div>
                <div class="w-1/2 text-right">
                    <p class="text-sm font-medium text-gray-700">Date:</p>
                    <p class="border-b border-gray-300 pb-1" id="detail-date">09/03/24</p>
                </div>
            </div>

            <div class="flex mb-4">
                <div class="w-2/3">
                    <p class="text-sm font-medium text-gray-700">Amount:</p>
                    <p class="border-b border-gray-300 pb-1" id="detail_amount">$105.00</p>
                </div>
                <div class="w-1/3 ml-4">
                    <p class="text-sm font-medium text-gray-700">In Words:</p>
                    <p class="border-b border-gray-300 pb-1" id="detail-num-word">One hundred five dollars</p>
                </div>
            </div>

            <div class="mb-4">
                <p class="text-sm font-medium text-gray-700">Address:</p>
                <p class="border-b border-gray-300 pb-1" id="detail_address">251 Timber Lodge Rd</p>
            </div>

            <div class="mb-4">
                <p class="text-sm font-medium text-gray-700">City, State, Zip:</p>
                <p class="border-b border-gray-300 pb-1">Los Angeles, CA 90001</p>
            </div>

            <div class="mb-4">
                <p class="text-sm font-medium text-gray-700">Memo:</p>
                <p class="border-b border-gray-300 pb-1" id="memo">Bookkeeping</p>
            </div>

            <div class="mt-8">
                <h2 class="text-lg font-bold">Expenses</h2>
                <table class="min-w-full bg-white">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="py-2 px-4 text-left">Description</th>
                            <th class="py-2 px-4 text-left">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="border-b border-gray-300 py-2 px-4">Operating expenses/Professional Fees</td>
                            <td class="border-b border-gray-300 py-2 px-4">$105.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>

        <script>
            const loans = "{{data}}"
            console.log("loans=",loans);
            const detail_date = document.getElementById("detail-date")
            const detail_amount = document.getElementById("detail_amount")
            const detail_address = document.getElementById("detail_address")
            const detail_word_num = document.getElementById("detail-num-word")
            const order_of = document.getElementById("order_of")
            const memo = document.getElementById("memo")
      

            function showDetail(id) {
                const apiUrl = `/api/loans/${id}/`;
          
                    $.ajax({
                        url: apiUrl,
                        method: 'GET',
                        success: function(data) {
                            detail_date.innerText = data.loan_date
                            detail_amount.innerText = data.loan_amount
                            detail_address.innerText = data.File_reference
                            detail_word_num.innerText =numberToWords(data.loan_amount)
                            order_of.innerText = data.order_of
                            memo.innerText = data.memo
                        },
                        error: function(error) {
                            console.error('Error fetching loans:', error);
                        }
                    });
               
               
            }


            function numberToWords(num) {
    if (num === 0) return "zero";

    const belowTwenty = [
        "zero", "one", "two", "three", "four", "five",
        "six", "seven", "eight", "nine", "ten", "eleven",
        "twelve", "thirteen", "fourteen", "fifteen", "sixteen",
        "seventeen", "eighteen", "nineteen"
    ];

    const tens = [
        "", "", "twenty", "thirty", "forty", "fifty",
        "sixty", "seventy", "eighty", "ninety"
    ];

    const thousands = ["", "thousand", "million"];

    const words = (n) => {
        if (n < 20) return belowTwenty[n];
        if (n < 100) return tens[Math.floor(n / 10)] + (n % 10 ? " " + belowTwenty[n % 10] : "");
        if (n < 1000) return belowTwenty[Math.floor(n / 100)] + " hundred" + (n % 100 ? " " + words(n % 100) : "");
        
        for (let i = 0; i < thousands.length; i++) {
            const divisor = Math.pow(1000, i);
            if (n < divisor * 1000) {
                return words(Math.floor(n / divisor)) + " " + thousands[i] + (n % divisor ? " " + words(n % divisor) : "");
            }
        }
    };

    return words(num).trim();
}

        </script>


{%endblock %}